<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>Xen - the Art of Virtualization</title>
    <meta name="generator" content="Muse">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <link rel="stylesheet" type="text/css"charset="utf-8" media="all" href="../styles/common.css"  />
  </head>

<body>

  <h1>Xen - the Art of Virtualization
   <!-- menu start here -->
     <div class="menu">
        <div class="menuitem">
          <a href="../home/index.html">Home</a>
        </div>
        <div class="menuitem">
          <a href="../emacs/index.html">Emacs</a>
        </div>
        <div class="menuitem">
          <a href="../complang/index.html">CompLang</a>
        </div>
        <div class="menuitem">
          <a href="../study/index.html">Study</a>
        </div>
	<div class="menuitem">
          <a href="../services/index.html">Services</a>
        </div>
	<div class="menuitem">
          <a href="../home/link.html">Links</a>
        </div>
      </div>
    <!-- menu ends here -->

  </h1>


  <!-- Page published by Emacs Muse begins here -->

<h2>学习笔记</h2>

<h3>Xen 3.3.1在ArchLinux上的编译和安装</h3>

<ol>
<li>安装几个必需的包：</li>
</ol>

<pre class="example">
pacman bridge-utils e2fsprogs iproute python sdl zlib
pacman mercurial patch
</pre>

<ol>
<li>运行make world进行一次完整的编译，它会清理上次编译残留的中间文件并开始一次全新的编译。</li>
</ol>

<p>以下除特殊说明部分，都是指Xen的para-virtualization部分。</p>

<ul>
<li>几个名词

<ul>
<li>domain: 它和guest os的关系相当于进程(process和程序(program)的关系</li>
</ul></li>
</ul>


<h3>内存管理</h3>

<p class="first">由于x86没有software-managed TLB支持，也没有TLB tag，地址空间的切换会清空整个TLB。所以为了性能考虑，Xen里面guest os直接负责管理硬件的page table，Xen仅负责对它的安全性检查；同时Xen驻留在所有地址空间的最高的64M区域里，这样就防止了进入/退出hypervisor时的TLB flush。</p>

<p>Xen为每个machine page frame关联了一个类型，包括PD, PT, LDT, GDT或者是RW(read/write)，每个frame只能有一种类型，从而保证了可写的页必定不是PT或是其他特殊的页面。当guest os指定某个页面用作page table时，Xen对这个页面做一次全面的检查，通过后就把它的类型设置为PD/PT，从而以后再使用这个页面时就不需要做多余的检查了。另外还有一个优化，因为guest os修改页表后通常会刷新TLB，因此先让它一次性本地修改完成，然后在执行刷新TLB的指令时再进行处理即可。</p>


<h3>CPU管理</h3>

<p class="first">x86上，Xen跑在ring 0，guest os在ring 1，application在ring 3</p>


<h3>IO设备</h3>



<h2>源码阅读</h2>

<h3>include/asm-x86/Config.h</h3>

<p class="first">x86中保留的64M内存的使用情况</p>

<pre class="src">
<span style="color: #ff5f00;">/*</span><span style="color: #ff5f00;">
 * Memory layout (high to low):                          SIZE   PAE-SIZE
 *                                                       ------ ------
 *  I/O remapping area                                   ( 4MB)
 *  Direct-map (1:1) area [Xen code/data/heap]           (12MB)
 *  Per-domain mappings (inc. 4MB map_domain_page cache) ( 8MB)
 *  Shadow linear pagetable                              ( 4MB) ( 8MB)
 *  Guest linear pagetable                               ( 4MB) ( 8MB)
 *  Machine-to-physical translation table [writable]     ( 4MB) (16MB)
 *  Frame-info table                                     (24MB) (96MB)
 *   * Start of guest inaccessible area
 *  Machine-to-physical translation table [read-only]    ( 4MB) (16MB)
 *   * Start of guest unmodifiable area
 </span><span style="color: #ff5f00;">*/</span>
</pre>



<!-- Page published by Emacs Muse ends here -->
<p>
<center>
最后更新：
2009-04-05 16:05:53
</center>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-2241833-7");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>

